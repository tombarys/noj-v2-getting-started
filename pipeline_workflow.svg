<?xml version="1.0" encoding="UTF-8"?>
<svg width="1200" height="800" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" 
     refX="0" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#333" />
    </marker>
    <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="2" dy="2" stdDeviation="2" flood-opacity="0.3"/>
    </filter>
  </defs>
  
  <!-- Background -->
  <rect width="1200" height="800" fill="#f8f9fa"/>
  
  <!-- Title -->
  <text x="600" y="30" text-anchor="middle" font-family="Arial, sans-serif" font-size="20" font-weight="bold" fill="#2c3e50">
    Book Recommendation System - Pipeline Workflow
  </text>
  
  <!-- Data Flow Section -->
  <g id="data-flow">
    <!-- Raw Data -->
    <rect x="20" y="60" width="120" height="60" rx="5" fill="#e8f4f8" stroke="#3498db" stroke-width="2" filter="url(#shadow)"/>
    <text x="80" y="85" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold">CSV Data</text>
    <text x="80" y="100" text-anchor="middle" font-family="Arial, sans-serif" font-size="10">raw-ds</text>
    
    <!-- Data Processing -->
    <rect x="180" y="60" width="140" height="60" rx="5" fill="#fef9e7" stroke="#f39c12" stroke-width="2" filter="url(#shadow)"/>
    <text x="250" y="80" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold">Data Processing</text>
    <text x="250" y="95" text-anchor="middle" font-family="Arial, sans-serif" font-size="9">create-one-hot-encoding</text>
    <text x="250" y="107" text-anchor="middle" font-family="Arial, sans-serif" font-size="9">processed-ds</text>
    
    <!-- Train/Test Split -->
    <rect x="360" y="60" width="120" height="60" rx="5" fill="#f0f3ff" stroke="#6c5ce7" stroke-width="2" filter="url(#shadow)"/>
    <text x="420" y="80" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold">Train/Test Split</text>
    <text x="420" y="95" text-anchor="middle" font-family="Arial, sans-serif" font-size="9">tc/split->seq</text>
    <text x="420" y="107" text-anchor="middle" font-family="Arial, sans-serif" font-size="9">:holdout</text>
    
    <!-- Arrows for data flow -->
    <line x1="140" y1="90" x2="180" y2="90" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
    <line x1="320" y1="90" x2="360" y2="90" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  </g>
  
  <!-- Three Approaches Section -->
  <text x="600" y="170" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#2c3e50">
    Three ML Pipeline Approaches
  </text>
  
  <!-- Approach 1: Direct ML -->
  <g id="approach1">
    <rect x="50" y="200" width="300" height="180" rx="10" fill="#fff5f5" stroke="#e74c3c" stroke-width="3" filter="url(#shadow)"/>
    <text x="200" y="225" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#c0392b">
      1. Direct ML Approach
    </text>
    
    <!-- XGBoost Model -->
    <rect x="70" y="240" width="120" height="50" rx="5" fill="#fdedec" stroke="#e74c3c" stroke-width="2"/>
    <text x="130" y="260" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold">XGBoost Model</text>
    <text x="130" y="275" text-anchor="middle" font-family="Arial, sans-serif" font-size="8">xgboost-simple-model</text>
    
    <!-- Function -->
    <rect x="210" y="240" width="120" height="50" rx="5" fill="#fadbd8" stroke="#e74c3c" stroke-width="2"/>
    <text x="270" y="255" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" font-weight="bold">Recommendation</text>
    <text x="270" y="268" text-anchor="middle" font-family="Arial, sans-serif" font-size="8">better-model-predict</text>
    <text x="270" y="280" text-anchor="middle" font-family="Arial, sans-serif" font-size="8">collaborative-recommend</text>
    
    <!-- Accuracy -->
    <rect x="120" y="310" width="160" height="30" rx="5" fill="#f8d7da" stroke="#e74c3c" stroke-width="1"/>
    <text x="200" y="330" text-anchor="middle" font-family="Arial, sans-serif" font-size="10">Accuracy: 0.098</text>
    
    <!-- Arrow -->
    <line x1="190" y1="265" x2="210" y2="265" stroke="#c0392b" stroke-width="2" marker-end="url(#arrowhead)"/>
  </g>
  
  <!-- Approach 2: Simplified Pipeline -->
  <g id="approach2">
    <rect x="400" y="200" width="300" height="180" rx="10" fill="#f0fff4" stroke="#27ae60" stroke-width="3" filter="url(#shadow)"/>
    <text x="550" y="225" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#229954">
      2. Simplified Pipeline
    </text>
    
    <!-- Train Pipeline -->
    <rect x="420" y="240" width="120" height="40" rx="5" fill="#e8f8f5" stroke="#27ae60" stroke-width="2"/>
    <text x="480" y="255" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" font-weight="bold">Train Pipeline</text>
    <text x="480" y="268" text-anchor="middle" font-family="Arial, sans-serif" font-size="8">train-model-pipeline</text>
    
    <!-- Predict Pipeline -->
    <rect x="560" y="240" width="120" height="40" rx="5" fill="#d5f4e6" stroke="#27ae60" stroke-width="2"/>
    <text x="620" y="255" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" font-weight="bold">Predict Pipeline</text>
    <text x="620" y="268" text-anchor="middle" font-family="Arial, sans-serif" font-size="8">predict-with-pipeline</text>
    
    <!-- Recommendation -->
    <rect x="470" y="295" width="120" height="40" rx="5" fill="#a9dfbf" stroke="#27ae60" stroke-width="2"/>
    <text x="530" y="310" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" font-weight="bold">Recommendation</text>
    <text x="530" y="323" text-anchor="middle" font-family="Arial, sans-serif" font-size="8">pipeline-recommend</text>
    
    <!-- Accuracy -->
    <rect x="470" y="350" width="120" height="20" rx="5" fill="#d5f4e6" stroke="#27ae60" stroke-width="1"/>
    <text x="530" y="365" text-anchor="middle" font-family="Arial, sans-serif" font-size="10">Accuracy: 0.098</text>
    
    <!-- Arrows -->
    <line x1="540" y1="260" x2="560" y2="260" stroke="#229954" stroke-width="2" marker-end="url(#arrowhead)"/>
    <line x1="580" y1="280" x2="550" y2="295" stroke="#229954" stroke-width="2" marker-end="url(#arrowhead)"/>
  </g>
  
  <!-- Approach 3: Metamorph Pipeline -->
  <g id="approach3">
    <rect x="750" y="200" width="400" height="180" rx="10" fill="#f5f3ff" stroke="#8b5cf6" stroke-width="3" filter="url(#shadow)"/>
    <text x="950" y="225" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#7c3aed">
      3. Metamorph Pipeline (mm/pipeline)
    </text>
    
    <!-- Pipeline Steps -->
    <rect x="770" y="240" width="100" height="45" rx="5" fill="#f3f4f6" stroke="#8b5cf6" stroke-width="2"/>
    <text x="820" y="255" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" font-weight="bold">Step 1</text>
    <text x="820" y="267" text-anchor="middle" font-family="Arial, sans-serif" font-size="7">Set Target</text>
    <text x="820" y="277" text-anchor="middle" font-family="Arial, sans-serif" font-size="7">(:fit mode)</text>
    
    <rect x="890" y="240" width="100" height="45" rx="5" fill="#ede9fe" stroke="#8b5cf6" stroke-width="2"/>
    <text x="940" y="255" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" font-weight="bold">Step 2</text>
    <text x="940" y="267" text-anchor="middle" font-family="Arial, sans-serif" font-size="7">Train Model</text>
    <text x="940" y="277" text-anchor="middle" font-family="Arial, sans-serif" font-size="7">(:fit mode)</text>
    
    <rect x="1010" y="240" width="100" height="45" rx="5" fill="#ddd6fe" stroke="#8b5cf6" stroke-width="2"/>
    <text x="1060" y="255" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" font-weight="bold">Step 3</text>
    <text x="1060" y="267" text-anchor="middle" font-family="Arial, sans-serif" font-size="7">Predict</text>
    <text x="1060" y="277" text-anchor="middle" font-family="Arial, sans-serif" font-size="7">(:transform mode)</text>
    
    <!-- Functions -->
    <rect x="790" y="300" width="140" height="35" rx="5" fill="#c4b5fd" stroke="#8b5cf6" stroke-width="2"/>
    <text x="860" y="315" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" font-weight="bold">fit-metamorph-pipeline</text>
    <text x="860" y="327" text-anchor="middle" font-family="Arial, sans-serif" font-size="8">:metamorph/mode :fit</text>
    
    <rect x="950" y="300" width="140" height="35" rx="5" fill="#a78bfa" stroke="#8b5cf6" stroke-width="2"/>
    <text x="1020" y="315" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" font-weight="bold">transform-with-pipeline</text>
    <text x="1020" y="327" text-anchor="middle" font-family="Arial, sans-serif" font-size="8">:metamorph/mode :transform</text>
    
    <!-- Recommendation -->
    <rect x="870" y="350" width="160" height="20" rx="5" fill="#8b5cf6" stroke="#7c3aed" stroke-width="2"/>
    <text x="950" y="365" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" font-weight="bold" fill="white">metamorph-pipeline-recommend</text>
    
    <!-- Accuracy -->
    <text x="950" y="385" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold">Accuracy: 0.098</text>
    
    <!-- Arrows -->
    <line x1="870" y1="262" x2="890" y2="262" stroke="#7c3aed" stroke-width="2" marker-end="url(#arrowhead)"/>
    <line x1="990" y1="262" x2="1010" y2="262" stroke="#7c3aed" stroke-width="2" marker-end="url(#arrowhead)"/>
    <line x1="930" y1="317" x2="950" y2="317" stroke="#7c3aed" stroke-width="2" marker-end="url(#arrowhead)"/>
  </g>
  
  <!-- Data Flow Connections -->
  <g id="connections">
    <!-- From split to approaches -->
    <line x1="480" y1="120" x2="200" y2="200" stroke="#95a5a6" stroke-width="2" stroke-dasharray="5,5" marker-end="url(#arrowhead)"/>
    <line x1="480" y1="120" x2="550" y2="200" stroke="#95a5a6" stroke-width="2" stroke-dasharray="5,5" marker-end="url(#arrowhead)"/>
    <line x1="480" y1="120" x2="950" y2="200" stroke="#95a5a6" stroke-width="2" stroke-dasharray="5,5" marker-end="url(#arrowhead)"/>
  </g>
  
  <!-- Key Features Section -->
  <g id="features">
    <rect x="50" y="420" width="1100" height="150" rx="10" fill="#f8f9fa" stroke="#6c757d" stroke-width="2" filter="url(#shadow)"/>
    <text x="600" y="445" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#2c3e50">
      Key Features &amp; Components
    </text>
    
    <!-- Features -->
    <g id="feature-boxes">
      <rect x="80" y="460" width="180" height="80" rx="5" fill="#e8f4f8" stroke="#3498db" stroke-width="2"/>
      <text x="170" y="480" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold">Data Processing</text>
      <text x="170" y="495" text-anchor="middle" font-family="Arial, sans-serif" font-size="9">• One-hot encoding</text>
      <text x="170" y="507" text-anchor="middle" font-family="Arial, sans-serif" font-size="9">• Book parsing</text>
      <text x="170" y="519" text-anchor="middle" font-family="Arial, sans-serif" font-size="9">• Customer aggregation</text>
      <text x="170" y="531" text-anchor="middle" font-family="Arial, sans-serif" font-size="9">• Target setting</text>
      
      <rect x="280" y="460" width="180" height="80" rx="5" fill="#fef9e7" stroke="#f39c12" stroke-width="2"/>
      <text x="370" y="480" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold">ML Models</text>
      <text x="370" y="495" text-anchor="middle" font-family="Arial, sans-serif" font-size="9">• XGBoost Classifier</text>
      <text x="370" y="507" text-anchor="middle" font-family="Arial, sans-serif" font-size="9">• Tribuo Framework</text>
      <text x="370" y="519" text-anchor="middle" font-family="Arial, sans-serif" font-size="9">• 100 trees, depth 6</text>
      <text x="370" y="531" text-anchor="middle" font-family="Arial, sans-serif" font-size="9">• Learning rate 0.1</text>
      
      <rect x="480" y="460" width="180" height="80" rx="5" fill="#f0f3ff" stroke="#6c5ce7" stroke-width="2"/>
      <text x="570" y="480" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold">Pipeline Modes</text>
      <text x="570" y="495" text-anchor="middle" font-family="Arial, sans-serif" font-size="9">• :fit mode - training</text>
      <text x="570" y="507" text-anchor="middle" font-family="Arial, sans-serif" font-size="9">• :transform mode - predict</text>
      <text x="570" y="519" text-anchor="middle" font-family="Arial, sans-serif" font-size="9">• Context preservation</text>
      <text x="570" y="531" text-anchor="middle" font-family="Arial, sans-serif" font-size="9">• State management</text>
      
      <rect x="680" y="460" width="180" height="80" rx="5" fill="#fff5f5" stroke="#e74c3c" stroke-width="2"/>
      <text x="770" y="480" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold">Recommendation Logic</text>
      <text x="770" y="495" text-anchor="middle" font-family="Arial, sans-serif" font-size="9">• Collaborative filtering</text>
      <text x="770" y="507" text-anchor="middle" font-family="Arial, sans-serif" font-size="9">• Similar customer search</text>
      <text x="770" y="519" text-anchor="middle" font-family="Arial, sans-serif" font-size="9">• Frequency-based ranking</text>
      <text x="770" y="531" text-anchor="middle" font-family="Arial, sans-serif" font-size="9">• Top-k results</text>
      
      <rect x="880" y="460" width="180" height="80" rx="5" fill="#f0fff4" stroke="#27ae60" stroke-width="2"/>
      <text x="970" y="480" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold">Evaluation Metrics</text>
      <text x="970" y="495" text-anchor="middle" font-family="Arial, sans-serif" font-size="9">• Classification accuracy</text>
      <text x="970" y="507" text-anchor="middle" font-family="Arial, sans-serif" font-size="9">• Consistent results: 0.098</text>
      <text x="970" y="519" text-anchor="middle" font-family="Arial, sans-serif" font-size="9">• Train/test split 42</text>
      <text x="970" y="531" text-anchor="middle" font-family="Arial, sans-serif" font-size="9">• Cross-validation ready</text>
    </g>
  </g>
  
  <!-- Libraries Used -->
  <g id="libraries">
    <text x="600" y="600" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#2c3e50">
      Libraries &amp; Technologies
    </text>
    
    <rect x="200" y="620" width="800" height="100" rx="10" fill="#f8f9fa" stroke="#6c757d" stroke-width="1"/>
    
    <text x="250" y="645" font-family="Arial, sans-serif" font-size="11" font-weight="bold">Core Libraries:</text>
    <text x="250" y="660" font-family="Arial, sans-serif" font-size="10">• tech.v3.dataset - Data manipulation</text>
    <text x="250" y="675" font-family="Arial, sans-serif" font-size="10">• tablecloth.api - Dataset operations</text>
    <text x="250" y="690" font-family="Arial, sans-serif" font-size="10">• scicloj.ml.tribuo - ML models</text>
    <text x="250" y="705" font-family="Arial, sans-serif" font-size="10">• scicloj.metamorph.core - Pipeline framework</text>
    
    <text x="600" y="645" font-family="Arial, sans-serif" font-size="11" font-weight="bold">Features:</text>
    <text x="600" y="660" font-family="Arial, sans-serif" font-size="10">• Functional pipeline composition</text>
    <text x="600" y="675" font-family="Arial, sans-serif" font-size="10">• Immutable data transformations</text>
    <text x="600" y="690" font-family="Arial, sans-serif" font-size="10">• Reproducible ML workflows</text>
    <text x="600" y="705" font-family="Arial, sans-serif" font-size="10">• Context-aware processing</text>
  </g>
  
  <!-- Performance Notes -->
  <rect x="50" y="750" width="1100" height="40" rx="5" fill="#fff3cd" stroke="#ffc107" stroke-width="2"/>
  <text x="600" y="770" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#856404">
    📊 Performance: All three approaches achieve identical accuracy (0.098) with 1000 rows dataset
  </text>
  <text x="600" y="785" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#856404">
    Metamorph pipeline provides the cleanest, most maintainable, and most composable solution
  </text>
</svg>
